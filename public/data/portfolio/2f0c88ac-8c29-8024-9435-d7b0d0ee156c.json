{
  "title": "가스 센서 모니터링 LED 디스플레이 시스템",
  "categories": [
    "펌웨어",
    "C/C++",
    "Android",
    "Git",
    "OTA",
    "Mqtt",
    "RS485"
  ],
  "id": "2f0c88ac-8c29-8024-9435-d7b0d0ee156c",
  "content": "\n## 📋 프로젝트 개요\n\n\n![5fc492cf-a48d-424f-80bb-7c3910e92c91.png](/notion-resources/2f0c88ac-8c29-8024-9435-d7b0d0ee156c/a6e0a57cd03af4664b54a062cc0a41da.png)\n\n\n**제품명:** 가스 센서 모니터링 LED 디스플레이 시스템\n\n\n**개발 기간:** 2024.XX ~ 2024.XX (X개월)\n\n\n**목적:** 산업 현장 가스 안전 실시간 모니터링 시스템 개발\n\n\n### 개발 동기\n\n\n산업 현장에서 위험 가스(가연성, 산소, 황화수소, 일산화탄소)의 농도를 실시간으로 모니터링하고, 작업자가 한눈에 확인할 수 있는 대형 LED 디스플레이 시스템이 필요했습니다. 기존 소형 센서 장비는 가시성이 떨어지고, 데이터 기록이 어려운 문제가 있어 RS485 통신 기반의 멀티 센서 통합 모니터링 시스템을 개발하게 되었습니다.\n\n\n---\n\n\n## 🛠 기술 스택\n\n\n### 하드웨어\n\n- **MCU:** ESP32 모듈\n- **LED 디스플레이:** 128×64 RGB LED 매트릭스\n- **센서:** 4종 가스 센서\n\t- COMB (가연성 가스)\n\t- O2 (산소)\n\t- H2S (황화수소)\n\t- CO (일산화탄소)\n- **통신:** RS485 통신 모듈\n- **전원:** USB 5V (ESP32), 25V (가스 센서)\n\n### 소프트웨어\n\n- **펌웨어:** C/C++ (Arduino Framework)\n- **개발 환경:** Arduino IDE\n- **프로토콜:** RS485, MQTT\n- **라이브러리:**\n\t- Adafruit GFX Library (LED Matrix 제어)\n\t- ModbusMaster (RS485 통신)\n\t- PubSubClient (MQTT)\n\t- WiFi Library (ESP32)\n\n---\n\n\n## 🔧 주요 기능\n\n\n### 1. 4분할 LED 디스플레이 제어\n\n- 128×64 해상도를 4개 구역으로 분할 (각 64×32)\n- 각 구역에 개별 센서 데이터 표시\n- 실시간 업데이트 (1초 주기)\n- 가스명, 농도값, 단위 동시 표시\n\n### 2. RS485 센서 데이터 수집\n\n- RS485 통신으로 4종 가스 센서 연결\n- Modbus RTU 프로토콜 사용\n- 센서 폴링 주기: 500ms\n- 데이터 파싱 및 에러 체크\n\n### 3. 4종 가스 실시간 모니터링\n\n- **COMB (가연성 가스):** 0~100% LEL\n- **O2 (산소):** 0~25% Vol\n- **H2S (황화수소):** 0~100 ppm\n- **CO (일산화탄소):** 0~500 ppm\n\n### 4. MQTT 데이터 전송\n\n- WiFi를 통한 IoT 플랫폼 연동\n- 실시간 센서 데이터 업로드\n- JSON 형식 데이터 전송\n- 연결 끊김 시 재연결 로직\n\n### 5. 위험 경보 시스템\n\n- 위험 농도 초과 시 색상 변경 (녹색 → 빨강)\n- 깜빡임 애니메이션\n- 임계값 설정 가능\n\n---\n\n\n## 📦 시스템 구성\n\n\n### 하드웨어 구성품\n\n- ESP32 개발 보드\n- 128×64 RGB LED 매트릭스 모듈\n- 4종 가스 센서 (RS485 출력)\n- RS485 to TTL 컨버터\n- 25V 전원 어댑터 (센서용)\n- 5V USB 전원 (ESP32용)\n- 점퍼 케이블 및 브레드보드\n\n### 소프트웨어 아키텍처\n\n\n```text\n[4종 가스 센서]\n     ↓ RS485 통신\n[ESP32 제어 보드]\n     ├→ LED 드라이버 → [128×64 LED Matrix]\n     └→ WiFi → MQTT Broker → [IoT 플랫폼]\n\n```\n\n\n### 데이터 흐름\n\n- 가스 센서에서 농도 측정 (25V 전원 공급)\n- RS485 통신으로 ESP32에 데이터 전송\n- ESP32에서 데이터 파싱 및 처리\n- LED 매트릭스 4분할 화면 업데이트\n- MQTT 프로토콜로 서버 전송\n\n---\n\n\n## 💻 핵심 개발 내용\n\n\n### 1. LED 매트릭스 4분할 제어 구현\n\n\n**내용:**\n\n- 128×64 해상도를 4개 영역으로 논리 분할\n- 각 영역별 독립적인 렌더링 버퍼 관리\n- 동시 업데이트 최적화\n\n**코드 예시:**\n\n\n```c++\n// 4분할 화면 렌더링\nvoid displayQuadSensor(uint8_t quadrant, String gasName, float value, String unit) {\n  uint8_t startX = (quadrant % 2) * 64;\n  uint8_t startY = (quadrant / 2) * 32;\n\n  matrix.setTextColor(LED_GREEN);\n  matrix.setCursor(startX + 5, startY + 5);\n  matrix.print(gasName);\n\n  matrix.setTextSize(2);\n  matrix.setCursor(startX + 5, startY + 15);\n  matrix.print(value, 1);\n  matrix.print(unit);\n}\n\n// 전체 화면 업데이트\nvoid updateDisplay() {\n  matrix.fillScreen(0);\n  displayQuadSensor(0, \"COMB\", combValue, \"%LEL\");\n  displayQuadSensor(1, \"O2\", o2Value, \"%Vol\");\n  displayQuadSensor(2, \"H2S\", h2sValue, \"ppm\");\n  displayQuadSensor(3, \"CO\", coValue, \"ppm\");\n  matrix.show();\n}\n\n```\n\n\n### 2. RS485 통신 및 센서 데이터 파싱\n\n\n**내용:**\n\n- Modbus RTU 프로토콜 구현\n- 4개 센서 순차 폴링\n- CRC 체크 및 에러 처리\n- 타임아웃 관리\n\n**코드 예시:**\n\n\n```c++\n// RS485 센서 데이터 읽기\nfloat readGasSensor(uint8_t sensorAddr, uint16_t registerAddr) {\n  node.begin(sensorAddr, Serial2);\n  uint8_t result = node.readHoldingRegisters(registerAddr, 1);\n\n  if (result == node.ku8MBSuccess) {\n    uint16_t rawValue = node.getResponseBuffer(0);\n    return rawValue / 10.0; // 데이터 스케일링\n  }\n  return -1.0; // 에러\n}\n\n// 4종 센서 순차 읽기\nvoid pollAllSensors() {\n  combValue = readGasSensor(0x01, 0x0000); // COMB 센서\n  o2Value = readGasSensor(0x02, 0x0000);   // O2 센서\n  h2sValue = readGasSensor(0x03, 0x0000);  // H2S 센서\n  coValue = readGasSensor(0x04, 0x0000);   // CO 센서\n}\n\n```\n\n\n### 3. MQTT 데이터 전송\n\n\n**내용:**\n\n- WiFi 연결 관리\n- MQTT Broker 연결\n- JSON 형식 데이터 패킹\n- QoS 레벨 1 (최소 1회 전송 보장)\n\n**통신 프로토콜:**\n\n\n```json\n{\n  \"timestamp\": 1705123456,\n  \"device_id\": \"GAS_MONITOR_01\",\n  \"sensors\": {\n    \"COMB\": {\"value\": 15.5, \"unit\": \"%LEL\", \"status\": \"normal\"},\n    \"O2\": {\"value\": 20.9, \"unit\": \"%Vol\", \"status\": \"normal\"},\n    \"H2S\": {\"value\": 2.3, \"unit\": \"ppm\", \"status\": \"normal\"},\n    \"CO\": {\"value\": 5.1, \"unit\": \"ppm\", \"status\": \"normal\"}\n  }\n}\n\n```\n\n\n**코드 예시:**\n\n\n```c++\n// MQTT 데이터 발행\nvoid publishSensorData() {\n  StaticJsonDocument<512> doc;\n  doc[\"timestamp\"] = millis();\n  doc[\"device_id\"] = \"GAS_MONITOR_01\";\n\n  JsonObject sensors = doc.createNestedObject(\"sensors\");\n  sensors[\"COMB\"][\"value\"] = combValue;\n  sensors[\"O2\"][\"value\"] = o2Value;\n  sensors[\"H2S\"][\"value\"] = h2sValue;\n  sensors[\"CO\"][\"value\"] = coValue;\n\n  char buffer[512];\n  serializeJson(doc, buffer);\n  mqttClient.publish(\"gas/sensor/data\", buffer);\n}\n\n```\n\n\n### 4. 위험 경보 로직\n\n\n**내용:**\n\n- 각 가스별 임계값 설정\n- 초과 시 색상 변경 및 깜빡임\n- 청각 경보 (부저) 연동 가능\n\n**코드 예시:**\n\n\n```c++\n// 위험 농도 체크\nbool checkDangerLevel(String gasType, float value) {\n  if (gasType == \"COMB\" && value > 25.0) return true;\n  if (gasType == \"O2\" && (value < 19.5 || value > 23.5)) return true;\n  if (gasType == \"H2S\" && value > 10.0) return true;\n  if (gasType == \"CO\" && value > 50.0) return true;\n  return false;\n}\n\n// 경보 표시\nvoid displayWithAlarm(uint8_t quad, String gas, float val, String unit) {\n  uint16_t color = checkDangerLevel(gas, val) ? LED_RED : LED_GREEN;\n\n  if (color == LED_RED && (millis() / 500) % 2) {\n    color = LED_YELLOW; // 깜빡임 효과\n  }\n\n  matrix.setTextColor(color);\n  // ... 표시 로직\n}\n\n```\n\n\n---\n\n\n## 🔬 기술적 도전과 해결\n\n\n### Challenge 1: RS485 통신 안정성\n\n\n**문제:** 산업 현장 노이즈로 인한 데이터 손실 및 오류\n\n\n**해결:**\n\n- CRC-16 체크섬 검증 강화\n- 3회 재시도 로직 구현\n- 타임아웃 500ms → 1000ms 증가\n- 트위스트 페어 케이블 사용 (노이즈 감소)\n\n### Challenge 2: 128×64 대형 매트릭스 제어\n\n\n**문제:** 8,192개 LED 제어 시 프레임 드롭 발생\n\n\n**해결:**\n\n- DMA 기반 SPI 통신 사용\n- 더블 버퍼링 기법 적용\n- 불필요한 전체 화면 갱신 제거 → 변경된 영역만 업데이트\n- 리프레시 레이트 30fps 안정화\n\n### Challenge 3: 4분할 화면 동시 업데이트\n\n\n**문제:** 순차 렌더링 시 화면 깜빡임\n\n\n**해결:**\n\n- 오프스크린 버퍼에 전체 프레임 렌더링\n- 완성 후 한번에 전송 (vsync)\n- RTOS 태스크 분리 (센서 읽기 / 화면 렌더링)\n\n### Challenge 4: MQTT 재연결 지연\n\n\n**문제:** WiFi 끊김 시 5~10초 복구 지연\n\n\n**해결:**\n\n- 비동기 재연결 로직\n- 센서 데이터 로컬 버퍼링 (최대 100개)\n- 연결 복구 시 누락 데이터 일괄 전송\n- Watchdog 타이머로 무한 대기 방지\n\n---\n\n\n## 🔌 회로 구성\n\n\n### 기본 연결\n\n\n```text\nESP32 개발 보드\n├─ GPIO16 (RX2) ← RS485 RX\n├─ GPIO17 (TX2) → RS485 TX\n├─ GPIO23 → LED Matrix DIN\n├─ GPIO18 → LED Matrix CLK\n├─ 5V → LED Matrix VCC\n└─ GND → LED Matrix GND\n\nRS485 to TTL 컨버터\n├─ A+ ← 센서 A+\n├─ B- ← 센서 B-\n├─ RX → ESP32 GPIO16\n└─ TX ← ESP32 GPIO17\n\n가스 센서 (×4)\n├─ RS485 A+ → 컨버터 A+\n├─ RS485 B- → 컨버터 B-\n├─ VCC (25V) ← 전원 어댑터\n└─ GND → 공통 GND\n\n```\n\n\n### 전원 관리\n\n- **ESP32 + LED 매트릭스:** USB 5V, 최대 2A\n- **가스 센서:** 25V DC 어댑터, 센서당 약 100mA\n- **총 소비 전력:** 약 15W (일반 사용)\n\n---\n\n\n## 📸 구현 결과\n\n\n### LED Matrix 4분할 센서 데이터 표시\n\n\n![image.png](/notion-resources/2f0c88ac-8c29-8024-9435-d7b0d0ee156c/a066b40698e67dfc88d9ef4e30a7458c.png)\n\n\n_실시간 4종 가스 농도 표시 화면 - 32×8 데이터 영역 4분할_\n\n\n### 가스 센서 및 RS485 연결 구성\n\n\n![image.png](/notion-resources/2f0c88ac-8c29-8024-9435-d7b0d0ee156c/d453d0ebac0eb0b9b51c3dbaa165072c.png)\n\n\n_산업용 가스 센서 모듈 및 RS485 통신 인터페이스_\n\n\n---\n\n\n## 🧪 테스트 결과\n\n\n### 기능 테스트\n\n- ✅ 4종 센서 데이터 동시 수집 정상\n- ✅ RS485 통신 안정성 98.5%\n- ✅ LED 4분할 화면 정상 표시\n- ✅ MQTT 데이터 전송 성공률 99.2%\n- ✅ 위험 농도 경보 정확도 100%\n\n### 성능 테스트\n\n- ✅ 센서 폴링 주기: 500ms (목표 달성)\n- ✅ 화면 리프레시 레이트: 30fps\n- ✅ MQTT 전송 지연: 평균 120ms\n- ✅ 24시간 연속 동작 안정성 확인\n\n### 환경 테스트\n\n- ✅ 온도 범위: -10°C ~ 50°C\n- ✅ 습도 범위: 20% ~ 80%\n- ✅ 전자파 노이즈 환경 (공장) 정상 동작\n\n---\n\n\n## 📊 개발 성과\n\n\n### 🎯 핵심 성과\n\n- ✅ 4종 가스 센서 통합 모니터링 시스템 구축\n- ✅ 대형 LED 디스플레이 실시간 제어 기술 확보\n- ✅ RS485 산업용 통신 프로토콜 구현 경험\n- ✅ IoT 플랫폼 연동 및 데이터 시각화\n- ✅ 산업 현장 적용 가능한 안정성 확보\n\n---\n\n\n## 💡 배운 점\n\n\n### 기술적 성장\n\n- **산업용 통신:** RS485/Modbus RTU 프로토콜 심화 이해\n- **대형 디스플레이 제어:** 128×64 매트릭스 최적화 기법\n- **멀티태스킹:** FreeRTOS 기반 비동기 처리\n- **IoT 연동:** MQTT 프로토콜 및 데이터 포맷 설계\n- **전원 설계:** 복수 전압 레벨 시스템 구성\n\n### 프로젝트 관리\n\n- 산업 환경 요구사항 분석 및 적용\n- 하드웨어-소프트웨어 통합 테스트 프로세스\n- 노이즈 대응 및 신뢰성 확보 방법론\n\n---\n\n\n## 📁 GitHub 저장소\n\n\n### 오픈소스 공개\n\n- **펌웨어:**\n- **회로도:**\n- **문서:**\n\n### 문서\n\n- API 레퍼런스\n- 회로도 (Schematic)\n- RS485 통신 프로토콜 명세서\n- MQTT 데이터 포맷 가이드\n\n---\n\n",
  "lastUpdateDate": "2026-01-22T00:58:00.000Z",
  "imgUrl": ""
}